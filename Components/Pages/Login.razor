@page "/login"
@using ExpenseTracker.Components.Pages.Dialogs
@using ExpenseTracker.Database.Models
@using ExpenseTracker.Dtos
@using ExpenseTracker.Services
@using MudBlazor.Extensions
@using System.Globalization
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject NotificationService NotificationService
@inject IdentityService IdentityService

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider /> 
<MudSnackbarProvider />

<MudForm @ref="form">
    <MudTextField @bind-Value="LoginData.Email" Label="Email" Variant="Variant.Text"
        Required="true" RequiredError="Email is required!">
    </MudTextField>

    <MudTextField @bind-Value="LoginData.Password" Label="Password" Variant="Variant.Text"
        Required="true" RequiredError="Password is required!" InputType="InputType.Password">
    </MudTextField>

    <MudCheckBox @bind-Value="LoginData.RememberMe" Label="Remember me"></MudCheckBox>
    <MudText Typo="Typo.body1">No account? <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="BtnRegister_Click">Register</MudButton></MudText>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@BtnLogin_Click">Login</MudButton>
    
</MudForm>

@code{

    private MudForm form;
    private LoginUserData LoginData = new LoginUserData();


    private async Task BtnLogin_Click(){
        
        await form.Validate();
        if (!form.IsValid)
        {
            return;
        }

        var result = await IdentityService.LoginAsync(LoginData);
        if(result.Succeeded){
            NavigationManager.NavigateTo("Dashboard");
        }
        else{
            await NotificationService.ShowErrorAsync(message: "Login failed");
        }
    }

    private void BtnRegister_Click(){
            NavigationManager.NavigateTo("Register");

    }
}